/**
 * Created by Michael on 2016/9/28.
 */
(function(){var a=angular.module("pasvaz.bindonce",[]);a.directive("bindonce",function(){var b=function(f){if(f&&f.length!==0){var e=angular.lowercase(""+f);f=!(e==="f"||e==="0"||e==="false"||e==="no"||e==="n"||e==="[]")}else{f=false}return f};var c=parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10);if(isNaN(c)){c=parseInt((/trident\/.*; rv:(\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1],10)}var d={restrict:"AM",controller:["$scope","$element","$attrs","$interpolate",function(h,f,e,l){var j=function(q,m,p){var n=(m==="show")?"":"none";var o=(m==="hide")?"":"none";q.css("display",b(p)?n:o)};var i=function(o,n){if(angular.isObject(n)&&!angular.isArray(n)){var m=[];angular.forEach(n,function(q,p){if(q){m.push(p)}});n=m}if(n){o.addClass(angular.isArray(n)?n.join(" "):n)}};var g=function(m,n){m.transclude(n,function(s){var q=m.element.parent();var r=m.element&&m.element[m.element.length-1];var o=q&&q[0]||r&&r.parentNode;var p=(r&&r.nextSibling)||null;angular.forEach(s,function(t){o.insertBefore(t,p)})})};var k={watcherRemover:undefined,binders:[],group:e.boName,element:f,ran:false,addBinder:function(m){this.binders.push(m);if(this.ran){this.runBinders()}},setupWatcher:function(n){var m=this;this.watcherRemover=h.$watch(n,function(o){if(o===undefined){return}m.removeWatcher();m.checkBindonce(o)},true)},checkBindonce:function(n){var m=this,o=(n.$promise)?n.$promise.then:n.then;if(typeof o==="function"){o(function(){m.runBinders()})}else{m.runBinders()}},removeWatcher:function(){if(this.watcherRemover!==undefined){this.watcherRemover();this.watcherRemover=undefined}},runBinders:function(){while(this.binders.length>0){var u=this.binders.shift();if(this.group&&this.group!=u.group){continue}var t=u.scope.$eval((u.interpolate)?l(u.value):u.value);switch(u.attr){case"boIf":if(b(t)){g(u,u.scope.$new())}break;case"boSwitch":var q,p=u.controller[0];if((q=p.cases["!"+t]||p.cases["?"])){u.scope.$eval(u.attrs.change);angular.forEach(q,function(w){g(w,u.scope.$new())})}break;case"boSwitchWhen":var m=u.controller[0];m.cases["!"+u.attrs.boSwitchWhen]=(m.cases["!"+u.attrs.boSwitchWhen]||[]);m.cases["!"+u.attrs.boSwitchWhen].push({transclude:u.transclude,element:u.element});break;case"boSwitchDefault":var m=u.controller[0];m.cases["?"]=(m.cases["?"]||[]);m.cases["?"].push({transclude:u.transclude,element:u.element});break;case"hide":case"show":j(u.element,u.attr,t);break;case"class":i(u.element,t);break;case"text":var v=$(u.element);if(v.attr("auto-length")!==undefined){var n=0;var s=v.width()/6-3;for(var o=0;o<t.length;o++){var r=t.charCodeAt(o);n+=((r>=0&&r<=128)?1:2);if(n>s){v.attr("title",t);t=t.substr(0,o+1)+"...";break}}}v.text(t);break;case"html":u.element.html(t);break;case"style":u.element.css(t);break;case"disabled":u.element.prop("disabled",t);break;case"src":u.element.attr(u.attr,t);if(c){u.element.prop("src",t)}break;case"attr":angular.forEach(u.attrs,function(y,x){var z,w;if(x.match(/^boAttr./)&&u.attrs[x]){z=x.replace(/^boAttr/,"").replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();w=u.scope.$eval(u.attrs[x]);u.element.attr(z,w)}});break;case"href":case"alt":case"title":case"id":case"value":u.element.attr(u.attr,t);break}}this.ran=true}};angular.extend(this,k)}],link:function(g,i,e,f){var h=e.bindonce&&g.$eval(e.bindonce);if(h!==undefined){f.checkBindonce(h)}else{f.setupWatcher(e.bindonce);i.bind("$destroy",f.removeWatcher)}}};return d});angular.forEach([{directiveName:"boShow",attribute:"show"},{directiveName:"boHide",attribute:"hide"},{directiveName:"boClass",attribute:"class"},{directiveName:"boText",attribute:"text"},{directiveName:"boBind",attribute:"text"},{directiveName:"boHtml",attribute:"html"},{directiveName:"boSrcI",attribute:"src",interpolate:true},{directiveName:"boSrc",attribute:"src"},{directiveName:"boHrefI",attribute:"href",interpolate:true},{directiveName:"boHref",attribute:"href"},{directiveName:"boAlt",attribute:"alt"},{directiveName:"boTitle",attribute:"title"},{directiveName:"boId",attribute:"id"},{directiveName:"boStyle",attribute:"style"},{directiveName:"boDisabled",attribute:"disabled"},{directiveName:"boValue",attribute:"value"},{directiveName:"boAttr",attribute:"attr"},{directiveName:"boIf",transclude:"element",terminal:true,priority:1000},{directiveName:"boSwitch",require:"boSwitch",controller:function(){this.cases={}}},{directiveName:"boSwitchWhen",transclude:"element",priority:800,require:"^boSwitch"},{directiveName:"boSwitchDefault",transclude:"element",priority:800,require:"^boSwitch"}],function(c){var b=200;return a.directive(c.directiveName,function(){var d={priority:c.priority||b,transclude:c.transclude||false,terminal:c.terminal||false,require:["^bindonce"].concat(c.require||[]),controller:c.controller,compile:function(f,g,e){return function(l,o,i,n){var k=n[0];var h=i.boParent;if(h&&k.group!==h){var j=k.element.parent();k=undefined;var m;while(j[0].nodeType!==9&&j.length){if((m=j.data("$bindonceController"))&&m.group===h){k=m;break}j=j.parent()}if(!k){throw new Error("No bindonce controller: "+h)}}k.addBinder({element:o,attr:c.attribute||c.directiveName,attrs:i,value:i[c.directiveName],interpolate:c.interpolate,group:h,transclude:e,controller:n.slice(1),scope:l})}}};return d})})})();

